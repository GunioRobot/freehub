-if @day == Date.today
  = render :partial => 'visits/person_search'
div.section.visits!
  -if @day == Date.today
    %h2 In the Shop Today!
  -else
    %h2 In the Shop on #{date_long(@day)}
  -if @visits.empty?
    %p.list_status No visits for #{@day.to_s(:db)}.
  -else
    %p.list_status #{@visits.size} visitors.
    -[{:key => :patrons, :label => 'Visiting'}, {:key => :volunteers, :label => 'Volunteering'}].each do |group|
      -if @groups[group[:key]].empty?
        -next
      %h3 #{@groups[group[:key]].size} #{group[:label]}
      %table.visits
        -reset_cycle
        -for visit in @groups[group[:key]]
          %tr{:class => cycle('odd','even')}
            -td(:style => 'width:200px;') 
              =link_to(visit.person.full_name, person_path(:id => visit.person))
            %td 
              -visit.person.person_type
            %td.time 
              -time_short(visit.datetime)
            -td.note(:style => 'width:400px;') 
              -note_text(visit.note)
            %td{:style => 'width:30px;'}
               =link_to 'Edit', edit_visit_path(:person_id => visit.person, :id => visit, :destination => day_visits_path)
            %td 
              =link_to 'Remove', visit_path(:person_id => visit.person, :id => visit, :destination => day_visits_path), :method => :delete
%div.section
  %p
    = "See "
    =link_to "previous", day_visits_path(@day.yesterday)
    -unless @day == Date.today
      = ' or '
      =link_to "next", day_visits_path(@day.tomorrow)
    = " day."

-# Original:

-#   0: if @day == Date.today
-#   1:   sign_in_search_panel
-#   4: div.section.visits! do
-#   5:   if @day == Date.today
-#   6:     h2 "In the Shop Today!"
-#   7:   else
-#   8:     h2 "In the Shop on #{date_long(@day)}"
-#  11:   if @visits.empty?
-#  12:     p.list_status "No visits for #{@day.to_s(:db)}."
-#  13:   else
-#  14:     p.list_status "#{@visits.size} visitors."
-#  16:     [{:key => :patrons, :label => 'Visiting'}, {:key => :volunteers, :label => 'Volunteering'}].each do |group|
-#  17:       next if @groups[group[:key]].empty?
-#  17:       next if @groups[group[:key]].empty?
-#  19:       h3 "#{@groups[group[:key]].size} #{group[:label]}"
-#  21:       table.visits do
-#  22:         reset_cycle
-#  23:         for visit in @groups[group[:key]]
-#  24:           tr :class => cycle('odd','even') do
-#  25:             td(:style => 'width:200px;') 
-#  26:               link_to(visit.person.full_name, person_path(:id => visit.person))
-#  27:             td 
-#  28:               visit.person.person_type
-#  29:             td.time 
-#  30:               time_short(visit.datetime)
-#  31:             td.note(:style => 'width:400px;') 
-#  32:               note_text(visit.note)
-#  33:             td :style => 'width:30px;' do
-#  34:                link_to 'Edit', edit_visit_path(:person_id => visit.person, :id => visit, :destination => day_visits_path)
-#  36:             td 
-#  37:               link_to 'Remove', visit_path(:person_id => visit.person, :id => visit, :destination => day_visits_path), :method => :delete
-#  47: div.section do
-#  48:   p do
-#  49:     text "See "
-#  50:     link_to "previous", day_visits_path(@day.yesterday)
-#  51:     unless @day == Date.today
-#  52:       text ' or '
-#  53:       link_to "next", day_visits_path(@day.tomorrow)
-#  55:     text " day."
